---
import ImageSlideshowReact from './ImageSlideshow';

interface ImageData {
	src: string;
	alt: string;
	caption?: string;
}

interface Props {
	images: ImageData[];
	autoplayInterval?: number;
	description?: string;
}

const { images, autoplayInterval = 5000, description } = Astro.props;

// Split description into headline (first few words) and rest
function splitHeadline(text: string, wordCount: number = 4) {
	const words = text.split(' ');
	if (words.length <= wordCount) {
		return { headline: text, rest: '' };
	}
	const headline = words.slice(0, wordCount).join(' ');
	const rest = words.slice(wordCount).join(' ');
	return { headline, rest };
}

const headlineParts = description ? splitHeadline(description, 4) : null;
---
<div class="slideshow-wrapper">
	<ImageSlideshowReact images={images} autoplayInterval={autoplayInterval} client:load />
	{description && headlineParts && (
		<div class="slideshow-description">
			<span class="headline-start">{headlineParts.headline}</span>
			{headlineParts.rest && <span class="headline-rest">{headlineParts.rest}</span>}
		</div>
	)}
</div>

<style>
	.slideshow-wrapper {
		width: 100%;
		max-width: 100%;
		box-sizing: border-box;
	}

	:global(.slideshow-container) {
		position: relative;
		width: 100%;
		max-width: 100%;
		height: 500px;
		min-height: 500px;
		overflow: hidden;
		background: #2c2416;
		box-sizing: border-box;
	}

	.slideshow-description {
		background: #fefcf8;
		border: 2px dashed #8b7355;
		border-top: 4px solid #8b4a4a;
		border-left: 4px solid #4a5568;
		padding: 2rem 2.5rem;
		margin-top: 0;
		font-family: 'Newsreader', 'Old Standard TT', 'Times New Roman', serif;
		line-height: 1.6;
		color: #2c2416;
		font-size: 1.1rem;
		text-align: justify;
		box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.15);
		position: relative;
		background-image: 
			url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='paper' x='0' y='0' width='100' height='100' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='20' cy='20' r='0.5' fill='%23d4c4a8' opacity='0.2'/%3E%3Ccircle cx='80' cy='40' r='0.5' fill='%23d4c4a8' opacity='0.15'/%3E%3Ccircle cx='40' cy='80' r='0.5' fill='%23d4c4a8' opacity='0.18'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100' height='100' fill='url(%23paper)'/%3E%3C/svg%3E");
	}

	.slideshow-description::before {
		content: '';
		position: absolute;
		top: -2px;
		right: -2px;
		width: 30px;
		height: 30px;
		border-top: 3px solid #8b4a4a;
		border-right: 3px solid #8b4a4a;
	}

	.slideshow-description::after {
		content: '';
		position: absolute;
		bottom: -2px;
		left: -2px;
		width: 30px;
		height: 30px;
		border-bottom: 3px solid #4a5568;
		border-left: 3px solid #4a5568;
	}

	.slideshow-description :global(.headline-start) {
		font-size: 2rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.08em;
		color: #4a5568;
		line-height: 1.1;
		display: inline-block;
		margin-right: 0.35em;
		font-family: 'Old Standard TT', 'Times New Roman', serif;
		vertical-align: baseline;
	}

	.slideshow-description :global(.headline-rest) {
		font-size: 1rem;
		font-weight: 400;
		text-transform: none;
		letter-spacing: normal;
		color: #2c2416;
		line-height: 1.7;
		font-family: 'Newsreader', 'Times New Roman', serif;
		vertical-align: baseline;
	}

	:global(.slideshow-container .slide) {
		width: 100%;
		height: 100%;
		display: block;
		position: relative;
	}

	:global(.slideshow-container .slide img) {
		width: 100%;
		max-width: 100%;
		height: 100%;
		min-height: 500px;
		display: block;
		object-fit: cover;
		object-position: center;
		filter: sepia(20%) contrast(1.1) brightness(0.95);
	}

	:global(.slideshow-container .react-slideshow-container) {
		width: 100%;
		max-width: 100%;
		height: 100%;
		min-height: 500px;
		box-sizing: border-box;
	}

	:global(.slideshow-container .react-slideshow-container .images-wrap) {
		width: 100%;
		max-width: 100%;
		height: 100%;
		min-height: 500px;
		box-sizing: border-box;
	}

	:global(.slideshow-container .react-slideshow-container .images-wrap > div) {
		width: 100%;
		max-width: 100%;
		height: 100%;
		min-height: 500px;
		box-sizing: border-box;
	}

	:global(.slideshow-container .react-slideshow-container .nav) {
		bottom: 120px;
		z-index: 15;
	}

	.slideshow-container :global(.react-slideshow-container .nav span) {
		width: 8px;
		height: 8px;
		border-radius: 50%;
		background: rgba(255, 255, 255, 0.4);
		border: 1px solid rgba(255, 255, 255, 0.3);
		opacity: 1;
		transition: all 0.3s ease;
		margin: 0 4px;
	}

	.slideshow-container :global(.react-slideshow-container .nav span.active) {
		background: rgba(255, 255, 255, 0.9);
		width: 24px;
		border-radius: 4px;
	}

	.slideshow-container :global(.react-slideshow-container .nav span:hover) {
		background: rgba(255, 255, 255, 0.6);
	}

	@media (max-width: 768px) {
		:global(.slideshow-container .react-slideshow-container .nav) {
			bottom: 100px;
		}

		.slideshow-container :global(.react-slideshow-container .nav span) {
			width: 6px;
			height: 6px;
		}

		.slideshow-container :global(.react-slideshow-container .nav span.active) {
			width: 20px;
		}

		.slideshow-description {
			padding: 1.5rem 1.25rem;
			font-size: 1rem;
		}

		.slideshow-description :global(.headline-start) {
			font-size: 1.5rem;
		}

		.slideshow-description :global(.headline-rest) {
			font-size: 0.95rem;
		}
	}
</style>
